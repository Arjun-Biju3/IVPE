{% extends 'blank_layout.html' %}

{% block navbar %}
{% include 'navbar.html' %}
{% endblock navbar %}

{% block content %}
{% load chunks %}
{% load static %}

<!-- detailed_result.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Vote Results</title>
    <!-- Add Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Container for candidate details and bar chart */
        .results-container {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-top: 140px;
            margin-left: 20px;
            padding: 20px;
            gap: 50px; /* Space between candidate details and bar chart */
        }

        /* Candidate details styling */
        .candidate-details {
            width: 300px; /* Fixed width for candidate details */
            text-align: left;
            padding-right: 20px;
            border-right: 2px solid #ccc;
        }

        .candidate-details img {
            border-radius: 50%;
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .candidate-details h2 {
            margin: 10px 0;
            font-size: 24px;
        }

        .candidate-details p {
            font-size: 18px;
            margin: 5px 0;
            color: #555;
        }

        /* Form and button container styling */
        .button-form {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            margin-left: -100px;
        }

        .button-container {
            display: flex;
            gap: 20px; /* Space between buttons */
        }

        .button-container button {
            padding: 10px 20px;
            font-size: 18px;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px; /* Rounded corners */
        }

        #publishResultBtn {
            background-color: #28a745; /* Green color for publish */
        }

        #revokeResultBtn {
            background-color: #dc3545; /* Red color for revoke */
        }

        /* Styling for the bar chart */
        .bar-container {
            display: flex;
            align-items: flex-end;
            gap: 20px; /* Space between bars */
        }

        .bar {
            width: 100px; /* Adjust width to fit the image */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        /* Candidate image styling for each bar */
        .bar img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }

        /* Bar rectangle for vote representation */
        .bar-rect {
            width: 50px;
            background-color: lightblue;
            transition: height 0.5s ease-in-out;
            margin-bottom: 10px;
        }

        /* Styling for vote count inside the bar */
        .vote-count {
            color: black;
            font-weight: bold;
            margin-top: 10px;
        }

        /* Candidate name styling */
        .label {
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        /* Pie chart container */
        .pie-chart-container {
            max-width: 400px;
            margin: 0 auto;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stats-container p {
            font-size: 18px;
            margin-top: 10px;
            font-weight: bold;
            color: #555;
        }

        /* Class to stack pie chart below bar chart */
        .stacked {
            flex-direction: column; /* Stack pie chart below bar chart */
        }

    </style>
</head>
<body>
   
    <!-- Container for candidate details, bar chart, and pie chart -->
    <div class="results-container">
        <!-- Candidate with maximum votes details -->
        <div class="candidate-details">
            <h2>Candidate with Maximum Votes</h2>
            
            <!-- Display candidate image -->
            <img src="{{ details.profile_image.url }}" alt="{{ details.first_name }} {{ details.last_name }}'s Profile Image">
            
            <!-- Display candidate name -->
            <h2>{{ details.first_name }} {{ details.last_name }}</h2>

            <!-- Display party affiliation -->
            <p><strong>Party Affiliation:</strong> {{ details.part_afiliation }}</p>

        </div>

        <!-- Bar chart container -->
        <div class="bar-container" id="histogram"></div>

        <!-- Pie Chart container -->
        <div class="stats-container" id="statsContainer">
            <div class="pie-chart-container">
                <h2>Voting Statistics</h2>
                <canvas id="votingPieChart" class="pie-chart"></canvas>
            </div>
            <!-- Display total and voted voters count -->
            <p>Total Voters: {{ total_voters }}</p>
            <p>Voted Voters: {{ voted_voters }}</p>
        </div>
    </div>

    <script>
        // Pass Django data to JavaScript
        const data = {{ data|safe }};
        
        // Get the container for the histogram
        const histogram = document.getElementById('histogram');

        // Determine maximum value for scaling
        const maxValue = Math.max(...Object.values(data).map(item => item.votes));

        // Create bars dynamically
        for (let candidate in data) {
            const candidateData = data[candidate];
            let barHeight = (candidateData.votes / maxValue) * 300; // Scale heights relative to the max value

            // Create a container for each candidate
            let bar = document.createElement('div');
            bar.className = 'bar';

            // Create and append the candidate image
            let img = document.createElement('img');
            img.src = candidateData.image;
            img.alt = candidate + "'s Image";
            bar.appendChild(img);

            // Create and append the vote count
            let voteCount = document.createElement('div');
            voteCount.className = 'vote-count';
            voteCount.innerText = candidateData.votes; // Vote count
            bar.appendChild(voteCount);

            // Create and append the bar rectangle
            let barRect = document.createElement('div');
            barRect.className = 'bar-rect';
            barRect.style.height = barHeight + 'px';
            barRect.style.backgroundColor = getRandomColor(); // Random color for each bar
            bar.appendChild(barRect);

            // Create and append label under the bar
            let label = document.createElement('div');
            label.className = 'label';
            label.innerText = candidate; // Candidate name
            bar.appendChild(label);

            // Add bar to histogram
            histogram.appendChild(bar);
        }

        // Function to get a random color
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Voting data for pie chart
        const totalVoters = {{ total_voters }};
        const votedVoters = {{ voted_voters }};
        const notVotedVoters = totalVoters - votedVoters;

        // Pie chart configuration
        const ctx = document.getElementById('votingPieChart').getContext('2d');
        const votingPieChart = new Chart(ctx, {
            type: 'doughnut', // Using doughnut chart for better label visibility
            data: {
                labels: ['Voted Voters', 'Not Voted Voters'],
                datasets: [{
                    label: 'Voting Statistics',
                    data: [votedVoters, notVotedVoters],
                    backgroundColor: ['#4CAF50', '#FF5733'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                const label = tooltipItem.label;
                                const value = tooltipItem.raw;
                                const percentage = ((value / totalVoters) * 100).toFixed(2);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Stack pie chart below the bar chart if histogram height exceeds 300px
        const histogramHeight = histogram.clientHeight;
        const statsContainer = document.getElementById('statsContainer');
        if (histogramHeight > 300) {
            statsContainer.classList.add('stacked');
        }
    </script>
</body>
</html>
{% endblock content %}
